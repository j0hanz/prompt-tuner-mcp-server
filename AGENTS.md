# AGENTS.md

## Project Overview

- TypeScript MCP (Model Context Protocol) server that provides two tools:
  - `fix_prompt`: spelling + grammar fixes only
  - `boost_prompt`: rewrite for clarity/effectiveness (preserve intent)
- Runtime: Node.js (ESM; `module: NodeNext`) with stdio transport (no HTTP server).
- LLM providers: OpenAI (`openai`), Anthropic (`@anthropic-ai/sdk`), Google Gemini (`@google/genai`).
- Validation: Zod v4 (`zod`). Logging: `pino`.

## Repo Map / Structure

- `src/`: server source
  - `src/index.ts`: CLI entry; boots server
  - `src/server.ts`: MCP server + stdio transport; registers tools/resources/prompts
  - `src/tools/`: tool implementations (`fix-prompt`, `boost-prompt`)
  - `src/prompts/`: quick workflow prompts (`fix`, `boost`)
  - `src/schemas/`: Zod input/output schemas
  - `src/config/`, `src/lib/`, `src/cli/`: config, utilities, CLI plumbing
- `tests/`: `node:test` suites (`*.test.ts`)
- `dist/`: compiled output (generated by `npm run build`)
- `docs/`: static assets (e.g., `docs/logo.png`)
- `scripts/`: repo maintenance utilities (see `scripts/Quality-Gates.ps1`)
- `metrics/`, `logs/`: generated artifacts from local scripts

## Setup & Environment

- Node.js: `>= 22.0.0` (see `package.json` → `engines.node`).
- Install deps:
  - Clean install (CI-style): `npm ci`
  - Regular install: `npm install`
- Configuration is via environment variables (see `CONFIGURATION.md`).
  - This repo does not load `.env` automatically; if you want `.env`, load it via your shell/tooling.

## Development Workflow

- Dev (watch, runs from `src/`): `npm run dev`
- Build (writes `dist/`): `npm run build`
- Run compiled server: `npm run start`
- Watch TypeScript compiler: `npm run watch`
- MCP Inspector (requires build output):
  - `npm run inspector`

Notes:

- `dev:http` and `start:http` are compatibility aliases (no HTTP transport yet).
- CLI flags exist; run `prompt-tuner-mcp-server --help` (or `npm run start -- --help`).

## Testing

- All tests: `npm run test`
- Watch mode: `npm run test:watch`
- Coverage: `npm run test:coverage`
- Test framework: Node’s built-in test runner (`node --test`) with TS support via `--import=tsx`.
- Test locations: `tests/*.test.ts`

## Code Style & Conventions

- Language: TypeScript (strict) targeting `ES2022`.
- Modules: ESM with `NodeNext` resolution. Import paths in TS use `.js` extensions (keep this pattern).
- Format: `npm run format` (Prettier; see `.prettierrc`, including import sorting).
- Lint: `npm run lint` (ESLint flat config; type-aware rules run on `src/**/*.ts`).
- Type-check: `npm run type-check` (`tsc --noEmit`).

Practical conventions enforced by linting/TS config:

- Prefer explicit function return types.
- Prefer `import type` for types; keep type/value imports consistent.
- Naming conventions: `camelCase` for most identifiers, `PascalCase` for types.

## Build / Release

- Build output: `dist/`
- Entry point: package `bin` points to `./dist/index.js`.
- Local prepublish gate: `npm run prepublishOnly` (runs `lint`, `type-check`, `build`).
- Release automation: GitHub workflow `.github/workflows/publish.yml` publishes on GitHub Release `published`.
  - Runs: `npm ci`, `npm run lint`, `npm run type-check`, `npm run test`, `npm run build`
  - Updates `package.json` version from the release tag and runs `npm publish --access public`.

## Security & Safety

- Never commit API keys; provide them via environment variables.
- Provider selection is controlled by `LLM_PROVIDER` and the corresponding API key env var.
- If enabling error context (`INCLUDE_ERROR_CONTEXT=true`), responses include a sanitized prompt snippet (truncated).
- External calls: tools can send prompt content to third-party LLM APIs; treat prompts as sensitive.
- Gemini safety filters can be disabled only via `GOOGLE_SAFETY_DISABLED=true`.

## Pull Request / Commit Guidelines

- Before opening a PR, run the same checks the publish workflow runs:
  - `npm run lint && npm run type-check && npm run test && npm run build`
- Add/adjust tests under `tests/` when changing tool behavior, schemas, or output normalization.
- Keep changes aligned with the ESM/NodeNext import style (including `.js` extensions).
